//https://github.com/Transmode/gradle-docker
apply plugin: 'java'
apply plugin: 'application'
apply plugin: 'docker'

buildscript {
    repositories { jcenter() }
    dependencies {
        classpath 'se.transmode.gradle:gradle-docker:1.2'
    }
}

sourceCompatibility = 1.7
group = "com.publicrelay"

docker {
    baseImage "ubuntu"
    maintainer 'Christopher J Lyth "chris.lyth@publicrelay.com"'
}

////    applicationName = "nginx"
////    runCommand 'echo "deb http://archive.ubuntu.com/ubuntu precise main universe" > /etc/apt/sources.list'
////    runCommand "apt-get update"
////    runCommand "apt-get install -y inotify-tools nginx apache2 openssh-server"

task buildDockerImage(type: Docker) << {
    println "We build the zip with version=$version"
}
task release(dependsOn: buildDockerImage)  {
    println "We release now $version"
}

gradle.taskGraph.whenReady {taskGraph ->
    if (taskGraph.hasTask(release)) {
        version = '1.0'
    } else {
        version = 'latest'
    }
}